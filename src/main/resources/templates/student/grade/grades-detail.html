<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
    <link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Montserrat:wght@400;500;700;900" onload="this.rel='stylesheet'" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <title>Система отслеживания успеваемости - Оценки</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
          darkMode: "class",
          theme: {
            extend: {
              colors: {
                primary: "#372579",
                "background-light": "#f5f7f8",
                "background-dark": "#101722",
              },
              fontFamily: {
                display: ["Montserrat"],
              },
              borderRadius: {
                DEFAULT: "0.25rem",
                lg: "0.5rem",
                xl: "0.75rem",
                full: "9999px",
              },
              fontSize: {
                'base': '16px',
              }
            },
          },
        };
    </script>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-base text-black">
<div class="flex h-screen flex-col">
    <div th:replace="~{student/fragments/header :: header (${fullName}, ${role}, 'grades')}"></div>

    <main class="flex-1 overflow-y-auto">
        <div class="mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8">
            <nav aria-label="breadcrumb">
                <ol class="inline-flex items-center space-x-1 md:space-x-3">
                    <li class="inline-flex items-center">
                        <a th:href="@{/student/dashboard}" class="inline-flex items-center text-sm font-medium text-black hover:text-primary">
                            Главная
                        </a>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <svg class="w-3 h-3 text-black mx-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                            </svg>
                            <a th:href="@{/student/grades}" class="ml-1 text-sm font-medium text-black hover:text-primary">Оценки</a>
                        </div>
                    </li>
                    <li aria-current="page">
                        <div class="flex items-center">
                            <svg class="w-3 h-3 text-black mx-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                            </svg>
                            <span class="ml-1 text-sm font-medium text-black" th:text="${subject.name}"></span>
                        </div>
                    </li>
                </ol>
            </nav>

            <div class="mt-4 flex flex-col gap-8 md:flex-row md:items-start md:justify-between">
                <div class="flex flex-col gap-1">
                    <h2 class="text-3xl font-bold text-black" th:text="${subject.name}"></h2>
                    <p class="text-black">
                        Преподаватель:
                        <span th:if="${teacherName != null}" th:text="${teacherName}"></span>
                        <span th:unless="${teacherName != null}" class="text-black">Не назначен</span>
                        | Семестр: <span th:text="${subject.semester}"></span> | Количество оценок: <span th:text="${grades.size()}"></span>
                    </p>
                </div>
            </div>

            <div class="mt-8 grid grid-cols-2 gap-4 md:grid-cols-3 lg:grid-cols-5">
                <div class="rounded-xl border border-gray-200/80 dark:border-gray-800/80 bg-background-light dark:bg-background-dark/50 p-4">
                    <p class="text-sm font-medium text-black">Средний балл</p>
                    <p class="mt-1 text-3xl font-bold text-primary" th:text="${#numbers.formatDecimal(avgGrade, 1, 2)} ?: '—'"></p>
                </div>
                <div class="rounded-xl border border-gray-200/80 dark:border-gray-800/80 bg-background-light dark:bg-background-dark/50 p-4">
                    <p class="text-sm font-medium text-black">Отлично (5)</p>
                    <p class="mt-1 text-3xl font-bold text-green-600 dark:text-green-500" th:text="${excellentCount}"></p>
                </div>
                <div class="rounded-xl border border-gray-200/80 dark:border-gray-800/80 bg-background-light dark:bg-background-dark/50 p-4">
                    <p class="text-sm font-medium text-black">Хорошо (4)</p>
                    <p class="mt-1 text-3xl font-bold text-green-700 dark:text-green-600" th:text="${goodCount}"></p>
                </div>
                <div class="rounded-xl border border-gray-200/80 dark:border-gray-800/80 bg-background-light dark:bg-background-dark/50 p-4">
                    <p class="text-sm font-medium text-black">Удовлетворительно (3)</p>
                    <p class="mt-1 text-3xl font-bold text-yellow-600 dark:text-yellow-500" th:text="${satisfactoryCount}"></p>
                </div>
                <div class="rounded-xl border border-gray-200/80 dark:border-gray-800/80 bg-background-light dark:bg-background-dark/50 p-4">
                    <p class="text-sm font-medium text-black">Неудовлетворительно (2)</p>
                    <p class="mt-1 text-3xl font-bold text-red-600 dark:text-red-500" th:text="${unsatisfactoryCount}"></p>
                </div>
            </div>

            <div class="mt-6 bg-white dark:bg-background-dark/50 rounded-xl p-6 shadow-sm">
                <div class="flex justify-between text-sm font-medium mb-3">
                    <span class="text-black">Прогресс среднего балла</span>
                    <span class="text-black" th:text="${#numbers.formatDecimal(avgGrade, 1, 2)} ?: '—'"></span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-800 rounded-full h-3">
                    <div class="bg-primary h-3 rounded-full"
                         th:style="${avgGrade != null and avgGrade > 0} ? 'width: ' + (${avgGrade} * 100 / 5) + '%' : 'width: 0%'"></div>
                </div>
            </div>

            <div class="mt-8 flow-root">
                <div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
                    <div class="inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8">
                        <div class="overflow-hidden rounded-lg border border-gray-200/80 dark:border-gray-800/80">
                            <table class="min-w-full divide-y divide-gray-200/80 dark:divide-gray-800/80">
                                <thead class="bg-gray-50 dark:bg-gray-900/50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-black" scope="col">Дата</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-black" scope="col">Тип работы</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-black" scope="col">Оценка</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-black" scope="col">Комментарий преподавателя</th>
                                </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200/80 dark:divide-gray-800/80 bg-background-light dark:bg-background-dark/50">
                                <tr th:each="grade : ${grades}">
                                    <td class="whitespace-nowrap px-6 py-4 text-sm text-black"
                                        th:text="${#temporals.format(grade.assessmentDate, 'dd.MM.yyyy')}"></td>
                                    <td class="whitespace-nowrap px-6 py-4 text-sm font-medium text-black"
                                        th:text="${grade.workType ?: '—'}"></td>
                                    <td class="whitespace-nowrap px-6 py-4">
                                            <span th:if="${grade.grade != null and grade.grade > 0}"
                                                  class="inline-flex items-center justify-center w-8 h-8 rounded-full font-medium text-white text-sm"
                                                  th:classappend="${grade.grade == 5} ? 'bg-green-500' :
                                                                  (${grade.grade == 4} ? 'bg-green-700' :
                                                                  (${grade.grade == 3} ? 'bg-yellow-500' : 'bg-red-500'))"
                                                  th:text="${grade.grade}">
                                            </span>
                                        <span th:unless="${grade.grade != null and grade.grade > 0}" class="text-black text-sm">—</span>
                                    </td>
                                    <td class="whitespace-nowrap px-6 py-4 text-sm text-black"
                                        th:text="${grade.comment ?: '—'}"></td>
                                </tr>
                                <tr th:if="${grades.empty}">
                                    <td colspan="4" class="px-6 py-8 text-center text-black">
                                        Оценок пока нет
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-6">
                <a th:href="@{/student/grades}" class="inline-flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-medium text-white hover:bg-primary/90 transition-colors">
                    <span class="material-symbols-outlined text-base">arrow_back</span>
                    Назад к списку предметов
                </a>
            </div>
        </div>
    </main>
</div>

<script src="/js/header.js"></script>
</body>
</html>